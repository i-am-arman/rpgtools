var powervals=[[1,1,[2,12]],[1,1,[3,11]],[1,1,[4,10]],[1,1,[5,9]],[1,1,[6,8]],[1,1,[7,7]],[2,1,[3,5,7]],[2,1,[2,4,9]],[2,1,[5,5,5]],[1,7,[8,14]],[1,7,[9,13]],[1,8,[9,14]],[1,8,[10,13]],[1,9,[10,14]],[1,9,[11,13]],[1,9,[12,12]],[1,10,[11,14]],[1,10,[12,13]],[1,11,[12,14]],[1,11,[13,13]],[1,12,[13,14]]];var rankdata=[[["1/3rd","1/2","2/3rd","Full"],["2/5","3/4","Full","Spells x 133%"],["1/2","Full","Spells x 133%","Spells x 150%"]],[[0.25,0.5,0.75,1],[0.4,0.75,1,2],[0.5,1,2,4]]];var codes="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function start(){$("#saveit").button().click(function(){$("#popup").dialog("option","width","30em").dialog("option","title","Copy to Save").html('<p>Click the button below to copy the text to the clipboard; alternatively, copy the code below manually. Make sure to get everything between (and including) the square brackets:</p><p><button id="btncopy">Copy to Clipboard</button><button id="btncookie">Save to Cookie</button></p><textarea id="txtcopy">'+save()+"</textarea>").dialog("open");$("#btncopy").button().click(function(){$("#popup textarea").select();document.execCommand("copy")});$("#btncookie").button().click(function(){saveCookie("race",$("#popup textarea").text())})});$("#classlist p span:last").hide();$("#loadit").button().click(function(){var a="";getCookies().forEach(function(b){var c="";if(b[1][0]=="{"){c="Magic"}else{if(b[1][0]=="("){c="Race"}else{return}}a+='<option value="'+b[1]+'">'+c+": "+b[0]+"</option>"});$("#cookielist").empty().append(a);$("#popload").dialog("open")});$("#loadit input").bind("input propertychange",function(){if(i(loadme.indexOf("[")!=0)&&(loadme.indexOf("{")!=0)){$("#loaderror").text("Error: save data may be corrupt. Make sure you copied the brackets at the beginning and end of the code!").show()}else{$("#loaderror").hide()}});$("#loadCookie").button().click(function(){load($("#cookielist").val());$("#popload").dialog("close")});$("#displayit").button().click(function(){$("#popup").dialog("option","title","Download Your Class").html("<p>Future: a pdf of your character class!</p>").dialog("open")});$("#powertrade").accordion({heightStyle:"fill"});makepower();$("#popup").dialog({modal:true,buttons:[{text:"Ok",click:function(){$(this).dialog("close")}}]});$("#popload").dialog({modal:true,autoOpen:false,buttons:[{text:"Ok",click:function(){if(load($("#popload input").val())){$(this).dialog("close");calc()}}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});$("#popask").dialog({modal:true,autoOpen:false,dialogClass:"no-close",buttons:[{text:"Ok",click:function(){$(".waitvalue").attr("cost",$(this).children("select").val());$(".waitvalue").children(".mycost").text($(this).children("select").val());$(".waitvalue").removeClass("waitvalue");$(this).children("select").empty();$(this).dialog("close");calc()}},{text:"Cancel",click:function(){remove($(".waitvalue"));$(this).dialog("close")}}]});$("#popspell").dialog({modal:true,autoOpen:false,buttons:[{text:"Cancel",click:function(){remove($(".waitvalue"));$(this).dialog("close")}},{text:"Ok",click:function(){var b=["at will","1/hr","1/8hr","1/day","1/week","1/month","1/year"];var a=$('#popspell input[type="number"]').val()*1;if($("#popspell input:radio:checked").val()=="turn"){a-=1}addRemove($(".waitvalue").empty().attr("cost",1).removeClass("waitvalue").removeClass("addspell").html('<span class="mycost" cost="1">1</span> '+$('#popspell input[type="textbox"]').val()+" (1 "+$("#popspell input:radio:checked").val()+", "+b[a]+")"));$('#popspell input[type="textbox"]').val("");$('#popspell input[type="number"]').val("");$("#popspell input:radio").prop("checked",false);$(this).dialog("close");calc()}}]});$("#casttime").buttonset();$("#poppower").dialog({modal:true,autoOpen:false,buttons:[{text:"Ok",click:function(){var a=$('#poppower input[type="number"]').val();addRemove($(".waitvalue").empty().attr("cost",a).removeClass("waitvalue").html('<span class="mycost" cost="'+a+'">'+a+"</span> "+$('#poppower input[type="textbox"]').val()));$("#poppower input").val("");$(this).dialog("close");calc()}},{text:"Cancel",click:function(){remove($(".waitvalue"));$(this).dialog("close")}}]})}function calc(){var f=0;var e=0,d=0,b=0,a=0,j=0,g=0;var c=($(".raceholder .class").length>0);var h="";$(".raceholder").each(function(k){$(this).children("div").each(function(){if($(this).hasClass("class")){switch($(this).text()){case"Hit DiceX":e++;break;case"FightingX":d++;break;case"ThiefX":b++;break;case"DivineX":a++;break;case"ArcaneX":j++;break;case"Custom MagicX":g++;break}}else{if($(this).hasClass("powers")){f+=$(this).attr("cost")*1}}});var m=$("#classlist p span:nth-child(6)").attr("cost").split(",");var l=Math.round((500*(e+d)+[0,200,500,700,1100][b]+[0,250,500,1000,2000][a]+625*j+m[g]*1+f*40)/25)*25;if(c){h=Math.round(l/2625*50)*1000+" additional"}else{h=Math.round(l/140)*1000;h=h+" or "+h*3+" additional"}$(this).children("span").text("Race "+k+": "+l+" xp")});$("#additional").text(h)}function makepower(){var d=$.extend(true,[],powervals);var g=0;while(d.length>0){var e=d.shift();var a="<span class='trade' count='"+e[0]+"' lvl='"+e[1]+"' trade='"+g+"' ret='";var f="'>"+e[0]+" lvl "+e[1]+" for ";while(e[2].length>0){var b=e[2].shift();a+=b+" ";f+="lvl "+b+", "}a+=f+"</span>";$("#tradelist").append(a);g++}$(".class,.power,.trade").draggable({helper:"clone",start:function(c,h){$(".raceholder").append("<div class='target' lvl='1'></div>");addDroppable();h.helper.addClass("helper")},stop:function(c,h){$(".raceholder>.target").remove()}})}function addDroppable(){$(".target").droppable({addClasses:false,tolerance:"pointer",accept:function(a){return $(this).hasClass("target")&&($(a).attr("lvl")==$(this).attr("lvl"))||($(a).hasClass("power"))||(($(this).attr("lvl")*1<2)&&($(a).hasClass("class")))},activeClass:"activetarget",drop:function(b,d){$(this).droppable("destroy");if(d.draggable.hasClass("class")){$(this).removeClass("target").addClass("powers").addClass("class").html(d.draggable.text()).attr("cost",d.draggable.attr("cost")).attr("trade",d.draggable.attr("trade"))}else{if(d.draggable.hasClass("power")){$(this).removeClass("target").addClass("powers").html('<span class="mycost" cost="'+d.draggable.attr("cost")+'"></span> '+d.draggable.text());if(d.draggable.hasClass("addspell")){$(this).addClass("waitvalue");$("#popspell").dialog("open")}else{if(d.draggable.hasClass("addpower")){$(this).addClass("waitvalue");$("#poppower").dialog("open")}else{if(d.draggable.attr("cost")=="arcane"){d.draggable.attr("arcane","true");if($('.raceholder .class[trade="4"]').length<3){$(this).children(".mycost").text(1);$(this).attr("cost",1)}else{$(this).children(".mycost").text(2);$(this).attr("cost",2)}}else{if(d.draggable.attr("cost").indexOf(",")>-1){var c=d.draggable.attr("cost").split(",");while(c.length>0){var f=c.shift();$("#popask select").append('<option value="'+f+'">'+f+"</option>")}$("#popask div p").text("Select value for '"+d.draggable.text()+"':");$(this).addClass("waitvalue");$("#popask").dialog("open");$(this).children(".mycost").click(function(){var g=$(this).attr("cost").split(",");while(g.length>0){var h=g.shift();$("#popask select").append('<option value="'+h+'">'+h+"</option>")}$("#popask div p").text("Select value for '"+d.draggable.text()+"':");$(this).parent().addClass("waitvalue");$("#popask").dialog("open")})}else{$(this).children(".mycost").text(d.draggable.attr("cost"));$(this).attr("cost",d.draggable.attr("cost"))}}}}}else{$(this).removeClass("target").addClass("powers").attr("cost",d.draggable.attr("count")).attr("trade",d.draggable.attr("trade"));var e=d.draggable.attr("ret").trim().split(" ");while(e.length>0){var a=e.shift();$(this).append("<div>@"+a+": <div class='target' lvl='"+a+"'></div></div>")}}}addRemove($(this));calc()}})}function addRemove(a){a.append('<span class="remove">X</span>');a.children(".remove").click(function(){remove($(this).parent());calc()})}function remove(a){if((a.parent().attr("id")=="powerholder")||(a.parent().hasClass("raceholder"))){a.remove()}else{a.removeClass("powers").addClass("target").text("")}}function save(){var a;if($("#name").val()!=""){a="("+$("#name").val()+"|"}else{a="(CustomRace|"}$(".raceholder>span").each(function(){var c=$(this).text().split(" ")[2]/25;a+=codes[Math.floor(c/64)]+codes[c&63]});raceCustomPowers=[];$(".raceholder").each(function(c){a+="+"+c;$(this).children("div").each(function(){if($(this).hasClass("class")){a+="/"+codes[$(this).attr("trade")*1+1]}else{a+=iterate(this)}})});while(raceCustomPowers.length>0){var b=raceCustomPowers.shift();a+="|"+b[0]+b[1]+b[2]}a+=")";return a}var raceCustomPowers;function iterate(b){var a=$(b).contents().filter(function(){return this.nodeType==3});if(a.length>0){a=a[0].nodeValue.trim()}else{a="UNKNOWN"}var f=$(b).attr("cost")*1;var e="";$(".power").each(function(g){if($(this).text()==a){var h=g*8+f*2;e=codes[Math.floor(h/64)]+codes[h&63];return false}});if(e!=""){return e}if($(b).children("div").length>0){var d=$(b).attr("trade")*1;e="="+codes[d];$(b).children("div").children("div").each(function(){e+=iterate(this)});return e}else{if($(b).hasClass("target")){return"/A"}else{var c=(101+raceCustomPowers.length*1)*8+f*2;raceCustomPowers.push([codes[raceCustomPowers.length],codes[f*2],a]);return codes[Math.floor(c/64)]+codes[c&63]}}}function load(a){if(a[0]=="{"){return loadMagic(a)}else{if(a[0]=="("){return loadRace(a)}else{return false}}}function loadMagic(d){$("#classlist p span").show();var b=d.split("|")[0].substr(1);d=d.split("|")[1];var c=codes.indexOf(d[0])*64+codes.indexOf(d[1]);var a;if(c<=1000){a=[Math.round(c/2),c,c*2,c*4]}else{if(c<=2000){a=[Math.round(c*2/5),Math.round(c*3/4),c,c*2]}else{a=[Math.round(c/3),Math.round(c/2),Math.round(c*2/3),c]}}$("#classlist p span:last").attr("cost",a.join(",")).text(b);return true}function loadRace(g){if(g.indexOf("{")>0){var e=g.substr(g.indexOf("{"),g.indexOf("}"));g=g.replace(e,"");loadMagic(e)}$("#name").val(g.substr(1,g.indexOf("|")-1));g=g.slice(0,-1);var c=g.split("|");g=(g.substr(g.indexOf("|")+1)).split("|")[0].substr(10);c.shift();c.shift();racemakecustomlist(c);var f="";var d=0;while(g.length>1){if(g.indexOf("+")==0){$("#race"+d).append(f);f="";d=g[1]*1;g=g.substr(2)}else{if((g.indexOf("/")==0)&&(g.indexOf("A")!=1)){var a=$("#classlist>p>span:nth-child("+codes.indexOf(g[1])+")");f+='<div class="powers class" lvl="1" cost="'+a.attr("cost")+'" trade="'+(codes.indexOf(g[1]*1)-1)+'">'+a.text()+"</div>";g=g.substr(2)}else{var b=uniterate(g,1);f+=b[0];g=b[1]}}}$("#race4").append(f);addRemove($(".raceholder .powers"));calc();return true}function racemakecustomlist(a){raceCustomPowers=[];while(a.length>0){var b=a.shift();var c=(codes.indexOf(b[1])-1)/2;raceCustomPowers.push([b[0],c,b.substr(2)])}}function uniterate(g,b){while(g.length>0){var d=g.substr(0,2);g=g.substr(2);if(d[0]=="="){var a=codes.indexOf(d[1]);var j=powervals[a][1];var f="<div class='powers' cost='1' lvl='"+b+"'><div>@"+powervals[a][2][0]+": ";var h=uniterate(g,powervals[a][2][0]);f+=h[0];g=h[1];f+="</div><div>@"+powervals[a][2][1]+": ";h=uniterate(g,powervals[a][2][1]);f+=h[0];g=h[1];if(powervals[a][2].length>2){f+="</div><div>@"+powervals[a][2][2]+": ";h=uniterate(g,powervals[a][2][2]);f+=h[0];g=h[1]}f+="</div></div>";return[f,g]}else{if(d=="/A"){return['<div class="target" lvl="'+b+'"></div>',g]}else{if((d[0]=="/")||(d[0]=="+")){return["",d+g]}else{var a=codes.indexOf(d[0])*64+codes.indexOf(d[1]);var j=(a&7)/2;a=Math.floor(a/8);if(a>=101){return["<div class='powers' cost='"+j+"'><span class='cost'>"+j+"</span> "+raceCustomPowers[a-101][2]+"</div>",g]}else{var e=$($(".power")[a]);return["<div class='powers' cost='"+j+"' lvl='"+b+"'><span class='cost' cost='"+e.attr("cost")+"'>"+j+"</span> "+e.text()+"</div>",g]}}}}}return["",g]}function getCookies(){var c=document.cookie.split(";");var b=[];for(var a=0;a<c.length;a++){var d=c[a].split("=");b.push([d[0],unescape(d[1])])}return b}function saveCookie(a,b){document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+"; path=/"}function eraseCookie(a){saveCookie(a,"",-1)};